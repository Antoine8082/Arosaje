{% extends 'base.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/detail.css') }}">
{% endblock %}
{% block body %}
    {% if app.user.id == post.userPost.id %}
        <label for="guardian">Gardien :</label>
        {% if post.guardian %}
            <input type="text" id="guardian" value="{{ post.guardian.email }}" disabled>
        {% else %}
            <input type="text" id="guardian">
        {% endif %}
    {% endif %}
    <span id="res_fetch_guardian"></span>
    {% set imagePath = '/uploads/images/' ~ post.image %}
    <h3>{{ post.title }}</h3>
    <p>{{ post.description }}</p>
    <div class="image">
        <img src="{{ imagePath }}" alt="" id="img_card">
    </div>
    <section>
        <h3>Espace commentaire</h3>
        <input type="text">
        {% for comment in post.comments %}
            <div class="comment-card {% if comment.type == "BOT"%}{% endif %}">
                <div class="author">{{ comment.user.email }}</div>
                <div class="dateSend">{{ comment.sendDate }}</div>
                <div class="comment-content">{{ comment.content }}</div>
            </div>
        {% endfor %}
    </section>
    <script>
        const inputGuard = document.querySelector('#guardian')
        inputGuard.addEventListener('change', ()=> {
           if(inputGuard.value.length >= 4){
               setGuardian(inputGuard.value)
           }
        });
        function setGuardian(inputGuardVal){
            const opts = {
                method : "POST",
                body : JSON.stringify({
                    post : {{ post.id }},
                    guardian : inputGuardVal
                }),
            };
            fetch('/api/guardian',opts)
                .then((res)=>res.json())
                .then((res) => {
                    const txt = document.querySelector('#res_fetch_guardian');
                    if(res.true){
                        txt.textContent = "Success !"
                        txt.classList.add('success')
                        txt.classList.remove('error')
                    }else{
                        txt.textContent = "Unknown user"
                        txt.classList.add('error')
                        txt.classList.remove('success')
                    }
                } );
        }
    </script>
{% endblock %}